<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Open Detection: Detection 3D</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <style>
        .carousel-inner > .item > img,
        .carousel-inner > .item > a > img {
            width: 70%;
            margin: auto;
        }
    </style>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
</script>
<link rel="search" href="search-opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="Open Detection"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Open Detection
   &#160;<span id="projectnumber">1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="usergroup0.html"><span>API&#160;Documentation</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.php" method="get">
              <img id="MSearchSelect" src="search/mag.png" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('detection_3d.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Detection 3D </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#detection_3d1">Detection 3D </a><ul><li class="level2"><a href="#detection_3d2">Detection based on global features</a><ul><li class="level3"><a href="#detection_3d3">Data</a></li>
<li class="level3"><a href="#detection_3d4">Code</a></li>
<li class="level3"><a href="#detection_3d5">Execution</a></li>
<li class="level3"><a href="#detection_3d6">Code explanation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="detection_3d1"></a>
Detection 3D </h1>
<p>3D detection methods are performed by the classes Detector3D. They accept a <code><a class="el" href="classod_1_1_o_d_scene_point_cloud.html" title="Class for 3D scene containing point cloud. ">od::ODScenePointCloud</a></code> and performs detection/recognition on them. We will go through a tutorial on global feature based detection for explanation.</p>
<h2><a class="anchor" id="detection_3d2"></a>
Detection based on global features</h2>
<p>In this tutorial we will cover the example in `examples/objectdetector/od_pc_global_real_time.cpp which is a demo of the detector class <a class="el" href="classod_1_1g3d_1_1_o_d_c_a_d_detector3_d_global.html" title="Detector based on 3D global features like VFH, ESF, CVFH etc. ">od::g3d::ODCADDetector3DGlobal</a>. This class detects 3D CAD models using global features of the point cloud. The corresponding Trainer class is <a class="el" href="classod_1_1g3d_1_1_o_d_c_a_d_detect_trainer3_d_global.html" title="Training class for the detector ODCADDetector3DGlobal. ">od::g3d::ODCADDetectTrainer3DGlobal</a>. They both internally use the functionality of the app 3d_rec_framework of PCL.</p>
<p>By default CADDetector3D (there is a CADDetector2D as well which detects CAD models in a 2D image - <a class="el" href="classod_1_1l2d_1_1_o_d_c_a_d_recognizer2_d_local.html" title="Simple RANSAC based 3D object recognizer. ">od::l2d::ODCADRecognizer2DLocal</a>) uses ESF (Ensemble of Shape Functions) as the global feature. Allowed features are VFH, CVFH and ESF which can be set through <code>setDescName()</code> or through the constructor.</p>
<h3><a class="anchor" id="detection_3d3"></a>
Data</h3>
<p>You need to get 3D CAD models of the objects you want to detect in the query scene. You can download CAD models from the CAD model databases available in the internet (eg: 3D warehouse: <a href="https://3dwarehouse.sketchup.com/?hl=en">https://3dwarehouse.sketchup.com/?hl=en</a>) or acquire your own CAD models of the real objects from a 3D scanners (which are popular in Robotics). We have provided some example CAD models in our <a class="el" href="getting_started.html#getting_started2">Data Repository</a> at location &lt;source_to_data&gt;/training_input/CADModels. If you don't have objects which look like them (which is obvious), you won't get successful detection. If you don't have a 3D scanner, I would suggest you to look at the CAD models in 3D warehouse which looks 'similar' to the real object. Thanks to the the 3D global features which do not require CAD models to be of exactly the same geometry as the real object. Somewhat 'similar looking' CAD model will work as well.</p>
<p>The CAD models is to be placed in a strict directory structure before training which is documented in <a class="el" href="classod_1_1g3d_1_1_o_d_c_a_d_detect_trainer3_d_global.html" title="Training class for the detector ODCADDetector3DGlobal. ">od::g3d::ODCADDetectTrainer3DGlobal</a>. This particular demo uses kinect to acquire Point Cloud in the real time, so you need a kinect device as well.</p>
<h3><a class="anchor" id="detection_3d4"></a>
Code</h3>
<p>The code is provided here verbatim.</p>
<div class="fragment"><div class="line"><span class="comment">/** \brief Example of the usage of global pipeline</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * \author Kripasindhu Sarkar</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;common/pipeline/ObjectDetector.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/pipeline/ODDetection.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;detectors/global3D/ODPointCloudGlobalMatching.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;common/utils/ODFrameGenerator.h&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"></div>
<div class="line">  std::string training_input_dir(argv[1]), trained_data_dir(argv[2]);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//trainer</span></div>
<div class="line">  <a class="code" href="classod_1_1_o_d_trainer.html">od::ODTrainer</a> *trainer = <span class="keyword">new</span> <a class="code" href="classod_1_1g3d_1_1_o_d_c_a_d_detect_trainer3_d_global.html">od::g3d::ODCADDetectTrainer3DGlobal</a>(training_input_dir, trained_data_dir);</div>
<div class="line">  trainer-&gt;<a class="code" href="classod_1_1_o_d_trainer.html#a06d82a0ac7adbf301d7535b302bdcdc5">train</a>();</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="comment">//detector</span></div>
<div class="line">  <a class="code" href="classod_1_1g3d_1_1_o_d_c_a_d_detector3_d_global.html">od::g3d::ODCADDetector3DGlobal&lt;pcl::PointXYZRGBA&gt;</a> *detector = <span class="keyword">new</span> <a class="code" href="classod_1_1g3d_1_1_o_d_c_a_d_detector3_d_global.html">od::g3d::ODCADDetector3DGlobal&lt;pcl::PointXYZRGBA&gt;</a>();</div>
<div class="line">  detector-&gt;<a class="code" href="classod_1_1_o_d_detector_common.html#a19122342f6d246755659c4c499a97be2">setTrainingInputLocation</a>(training_input_dir);</div>
<div class="line">  detector-&gt;<a class="code" href="classod_1_1_o_d_detector_common.html#ace88b89c12b81dbce4b713a2f9dbcbe8">setTrainedDataLocation</a>(trained_data_dir);</div>
<div class="line">  detector-&gt;<a class="code" href="classod_1_1g3d_1_1_o_d_c_a_d_detector3_d_global.html#a8a6e277f39b4cc3690eb70c6746af06b">init</a>();</div>
<div class="line"></div>
<div class="line">  <span class="comment">//GUI and feedback</span></div>
<div class="line">  <a class="code" href="classod_1_1_o_d_scene_point_cloud.html">od::ODScenePointCloud&lt;pcl::PointXYZRGBA&gt;</a> *frame;</div>
<div class="line"></div>
<div class="line">  pcl::visualization::PCLVisualizer vis (<span class="stringliteral">&quot;kinect&quot;</span>);</div>
<div class="line"></div>
<div class="line">  od::ODFrameGenerator&lt;od::ODScenePointCloud&lt;pcl::PointXYZRGBA&gt;, od::GENERATOR_TYPE_DEVICE&gt; frameGenerator;</div>
<div class="line">  <span class="keywordflow">while</span>(frameGenerator.isValid())</div>
<div class="line">  {</div>
<div class="line"></div>
<div class="line">    frame = frameGenerator.getNextFrame();</div>
<div class="line"></div>
<div class="line">    <span class="comment">//remove previous point clouds and text and add new ones in the visualizer</span></div>
<div class="line">    vis.removeAllPointClouds();</div>
<div class="line">    vis.removeAllShapes();</div>
<div class="line">    vis.addPointCloud&lt;pcl::PointXYZRGBA&gt; (frame-&gt;<a class="code" href="classod_1_1_o_d_scene_point_cloud.html#a12fa982b49cc6745c257f50b8a504ab1">getPointCloud</a>(), <span class="stringliteral">&quot;frame&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Detect</span></div>
<div class="line">    <a class="code" href="classod_1_1_o_d_detections3_d.html">od::ODDetections3D</a> * detections = detector-&gt;<a class="code" href="classod_1_1g3d_1_1_o_d_c_a_d_detector3_d_global.html#a0fd1918107713d82094f913fe39eee03">detectOmni</a>(frame);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//add all the detections in the visualizer with its id as text</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; detections-&gt;size (); i++)</div>
<div class="line">    {</div>
<div class="line">      std::stringstream cluster_name;</div>
<div class="line">      cluster_name &lt;&lt; <span class="stringliteral">&quot;cluster_&quot;</span> &lt;&lt; i;</div>
<div class="line">      pcl::visualization::PointCloudColorHandlerRandom&lt;pcl::PointXYZ&gt; random_handler (detections-&gt;at(i)-&gt;getMetainfoCluster());</div>
<div class="line">      vis.addPointCloud&lt;pcl::PointXYZ&gt; (detections-&gt;at(i)-&gt;getMetainfoCluster(), random_handler, cluster_name.str ());</div>
<div class="line"></div>
<div class="line">      pcl::PointXYZ pos; pos.x = detections-&gt;at(i)-&gt;getLocation()[0]; pos.y = detections-&gt;at(i)-&gt;getLocation()[1]; pos.z = detections-&gt;at(i)-&gt;getLocation()[2];</div>
<div class="line">      vis.addText3D (detections-&gt;at(i)-&gt;getId(), pos, 0.015f, 1, 0, 1, cluster_name.str() + <span class="stringliteral">&quot;_txt&quot;</span>, 0);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    vis.spinOnce ();</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="detection_3d5"></a>
Execution</h3>
<p>After compiling the OD tree, run the binary from the build directory as: </p>
<pre class="fragment">examples/objectdetector/od_example_pc_global_real_time &lt;path_to_CAD_models&gt; &lt;trained_data_directory&gt;
</pre><p>You will see output similar to the following video:</p>
 
<div align="center">
<iframe width="420" height="315" src="https://www.youtube.com/embed/kosqMb6aeMU" frameborder="0" allowfullscreen></iframe>
</div>
<h3><a class="anchor" id="detection_3d6"></a>
Code explanation</h3>
<p>The code is straightforward and self explanatory. We first initialize detector and trainer with <code>training input location</code> with CAD models and the <code>trained_data location</code>. </p>
<pre class="fragment">   //trainer
    od::ODTrainer *trainer = new od::g3d::ODCADDetectTrainer3DGlobal(training_input_dir, trained_data_dir);
    trainer-&gt;train();

    //detector
    od::g3d::ODCADDetector3DGlobal&lt;pcl::PointXYZRGBA&gt; *detector = new od::g3d::ODCADDetector3DGlobal&lt;pcl::PointXYZRGBA&gt;();
    detector-&gt;setTrainingInputLocation(training_input_dir);
    detector-&gt;setTrainedDataLocation(trained_data_dir);
    detector-&gt;init();     
</pre><p>We then get a FrameGenerator of PointCloud and Device types to get Point Cloud Scene from kinect device. We also instantiate a VTK window through PCLVisualizer.</p>
<pre class="fragment">pcl::visualization::PCLVisualizer vis ("kinect");
od::ODFrameGenerator&lt;od::ODScenePointCloud&lt;pcl::PointXYZRGBA&gt;, od::GENERATOR_TYPE_DEVICE&gt; frameGenerator;
</pre><p>We then get Point Cloud scenes in a loop and perform Omnidetection on them. </p>
<pre class="fragment"> frame = frameGenerator.getNextFrame();     
 //Detect
 od::ODDetections3D * detections = detector-&gt;detectOmni(frame);
</pre><p>We then add each detection made in the PCLVisualizer window with different colors and draw its classification ID on top of them. </p>
<pre class="fragment"> vis.addPointCloud&lt;pcl::PointXYZ&gt; (detections-&gt;at(i)-&gt;getMetainfoCluster(), random_handler, cluster_name.str ());

pcl::PointXYZ pos; pos.x = detections-&gt;at(i)-&gt;getLocation()[0]; pos.y = detections-&gt;at(i)-&gt;getLocation()[1]; pos.z = detections-&gt;at(i)-&gt;getLocation()[2];
  vis.addText3D (detections-&gt;at(i)-&gt;getId(), pos, 0.015f, 1, 0, 1, cluster_name.str() + "_txt", 0);</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<hr>
<div id="footer">
<p>
Send your queries <a href="mailto:kripasindhu.sarkar@dfki.de?Subject=OpenDetection" target="_top">here</a>.
</p>
<p>Pages generated on Sat Oct 3 2015 21:00:43</p>
</div> <!-- #footer -->
</body>
</html>
